---
name: critics-reviewer
description: PRの変更内容を批判的にレビューし、懸念点を調査してmdに保存する
---

PRのコードレビューアとして、変更内容を批判的に調査し、懸念点のみを抽出してMarkdownファイルに保存する。

**重要: このタスクは複雑な判断を伴うため、ultrathink を使用して深く思考すること。**

## 引数

`$ARGUMENTS`

- **指定あり**: その値をPR番号として使用する
- **未指定**: `gh pr view` で現在のブランチに紐づくPRを自動取得する

## 実行フロー

### 1. PR情報の取得

```bash
gh pr view [PR番号] --json number,title,body,url,headRefName,baseRefName
```

PRが見つからない場合はその旨を伝え、処理を終了する。

### 2. 変更内容の取得

```bash
gh pr diff [PR番号]
```

### 3. 懸念点の調査

変更内容をレビューし、懸念点のみを抽出する
たとえば以下が例であるが、それ以外の懸念点も確認する

#### セキュリティ
- SQLインジェクション、XSS、コマンドインジェクションなどの脆弱性
- 認証・認可の欠陥
- 機密情報のハードコーディング

#### バグ・不具合
- Nullポインタ参照の可能性
- 境界条件の考慮漏れ
- 例外処理の不備
- 競合状態（Race Condition）

#### パフォーマンス
- N+1クエリ
- 不要なループ・計算
- メモリリーク

#### 設計・保守性
- 責務の分離違反
- 既存パターンとの不整合
- テスト容易性の低下

### 4. ガイドライン準拠の確認

プロジェクト内の以下のファイルが存在する場合、その内容に沿っているかを確認する:

- `AGENTS.md`
- `CLAUDE.md`
- `CONTRIBUTING.md`
- `GUIDELINES.md`
- `docs/`配下のガイドライン系ドキュメント

**確認観点**:
- コーディング規約への準拠
- 命名規則の遵守
- アーキテクチャ・設計方針との整合性
- 禁止されているパターンの使用有無
- 推奨されているパターンの採用有無

ガイドラインに違反している場合は懸念点として記録する。

### 5. 懸念点の分類

| 重要度 | 意味 |
|--------|------|
| CRITICAL | 必ず修正すべき深刻な問題（セキュリティ、データ破損） |
| HIGH | 修正を強く推奨する問題（バグ、重大なパフォーマンス問題） |
| MEDIUM | 検討を推奨する問題（設計改善、軽微なパフォーマンス問題） |

## 出力フォーマット

```markdown
# PR #[番号] レビュー懸念点

## 概要

- **PR**: [タイトル]
- **URL**: [PRのURL]
- **調査日**: YYYY-MM-DD

## サマリー

| 重要度 | 件数 |
|--------|------|
| CRITICAL | N |
| HIGH | N |
| MEDIUM | N |

## 懸念点一覧

### 1. [懸念点のタイトル]

| 項目 | 内容 |
|------|------|
| 重要度 | **CRITICAL** / **HIGH** / **MEDIUM** |
| カテゴリ | security / bug / performance / design / guideline |
| ファイル | `path/to/file.ts` (行番号) |

**問題点**:
具体的な問題の説明

**該当コード**:
```言語
問題のあるコード
```

**推奨対応**:
修正の方向性や具体的な改善案
```

## ファイル保存

分析完了後、結果を `documents/critics-review-pr-<PR番号>.md` に自動保存する。
保存後、パスを簡潔に報告する。

## 制約事項

- **懸念点のみ抽出**: 良い点や問題のない箇所についてはコメントしない
- **コード修正は行わない**: 懸念点の報告のみ行い、実際の修正は行わない
- **日本語で記述**: すべての出力は日本語で記述する
